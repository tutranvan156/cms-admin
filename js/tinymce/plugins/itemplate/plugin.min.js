/**
 * iNet paragraph template
 * insert paragraph template from template lib
 * created by Huyen Doan <huyendv@inetcloud.vn>
 * 09:40 29/06/2015
 */

/*global tinymce:true */

tinymce.PluginManager.add('itemplate', function (editor) {
  var olMenuItems, lastStyles = {};

  function buildMenuItems(data) {
    console.log('build');
    var items = [];
    var __data = data || [];
    for (var i = 0; i < __data.length; i++) {
      items.push({
        text: __data[i].name,
        data: __data[i].uuid
      });
    }

    return items;
  }

  olMenuItems = buildMenuItems(editor.settings.itemplateData);

  function selectedChange(uuid) {
    var __uuid = uuid || '';
    var __data = editor.settings.itemplateData || [];
    if (__uuid != '') {
      for (var i = 0; i < __data.length; i++) {
        if (__data[i].uuid == __uuid) {
          editor.focus();
          editor.insertContent(__data[i].message);
          return;
        }
      }
    }
  }

  editor.addButton('inettemplate', {
    icon: 'template',
    type: 'splitbutton',
    tooltip: 'Mẫu bài viết/Đoạn văn',
    menu: olMenuItems,
    onselect: function (e) {
      selectedChange(e.control.settings.data);
    },
    onclick: function () {
      return;
    }
  });
});