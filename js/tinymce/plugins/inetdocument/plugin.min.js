tinymce.PluginManager.add('inetdocument', function (editor) {
  var olMenuItems, lastStyles = {};
  var tinymceMedia = {title: 'brief', mediaId: 'uuid', name: 'file', service: 'service'};

  function buildMenuItems(data) {
    var items = [];
    var __data = data || [];
    for (var i = 0; i < __data.length; i++) {
      items.push({
        text: __data[i].name,
        data: __data[i].code
      });
    }

    return items;
  }

  var mediaDocument = editor.settings.mediaDocument || [];
  if (mediaDocument.length <= 0) {
    mediaDocument = [{
      code: 'LIB_DOCUMENT',
      name: 'Chọn tập tin'
    }, {
      code: 'UPLOAD_DOCUMENT',
      name: 'Tải lên tập tin'
    }, {
      code: 'LINK_DOCUMENT',
      name: 'Nhập đường dẫn tập tin'
    }]
  }
  olMenuItems = buildMenuItems(mediaDocument);

  function selectedChange(e) {
    if (e == 'UPLOAD_DOCUMENT') {
      openUpload();
    } else if (e == 'LINK_DOCUMENT') {
      openLink();
    } else if (e == 'LIB_DOCUMENT') {
      openMediaLib();
    }
  }

  function openMediaLib() {
    tinymce.fire('mediadocumentselector');
  }

  function openUpload() {
    tinymce.fire('mediadocumentupload');
  }

  function openLink() {
    tinymce.fire('mediadocumentlink');
  }

  console.log('ediit');

  editor.addButton('customlink', {
    text: 'Liên kết trang',
    icon: false,
    onclick: function () {
      console.log('click...');
      tinymce.fire('custom_link');
    }
  });

  editor.addButton('mediadocument', {
    type: 'splitbutton',
    icon: 'browse',
    tooltip: 'Chèn tập tin',
    menu: olMenuItems,
    onselect: function (e) {
      selectedChange(e.control.settings.data);
    },
    onclick: function () {
      selectedChange('LIB_DOCUMENT');
    }
  });

  tinymce.inetMediaAddDocument = function (src, data) {
    var __src = src || '';
    if (__src != '') {
      var __div = {
        'data-service': 'community-asset-upload'
      };
      var fileLink = {
        id: '__mcenew_' + iNet.generateId(),
        href: __src,
        title: editor.selection.getContent() || (data[tinymceMedia.title] || ''),
        style: '',
        target: '_blank',
        "class": ''
      };
      console.log(fileLink)
      var linkElm = editor.selection.getNode();
      editor.focus();
      editor.selection.setContent(editor.dom.createHTML('span', __div, editor.dom.createHTML('a', fileLink, fileLink.title)));
      linkElm = editor.dom.get(fileLink.id);
      editor.dom.setAttribs(linkElm, {
        'id': null,
        'data-item': data[tinymceMedia.mediaId],
        'data-name': data[tinymceMedia.name],
        'data-image': false
      });
    }
  };
});