/**
 * iNet preview
 * insert paragraph template from template lib
 * created by Huyen Doan <huyendv@inetcloud.vn>
 * 09:40 29/06/2015
 */

/*global tinymce:true */

tinymce.PluginManager.add('ipreview', function (editor) {
  var olMenuItems, lastStyles = {};

  function buildMenuItems(data) {
    var items = [];
    var __data = data || [];
    for (var i = 0; i < __data.length; i++) {
      items.push({
        text: __data[i],
        data: __data[i]
      });
    }

    return items;
  }

  olMenuItems = buildMenuItems(editor.settings.ipreviewData);

  function selectedChange(uri) {
    tinymce.fire('ipreview', {uri: uri || ''});
  }

  editor.addButton('inetpreview', {
    icon: 'preview',
    type: 'splitbutton',
    tooltip: 'Xem trước bài viết',
    menu: olMenuItems,
    onselect: function (e) {
      selectedChange(e.control.settings.data);
    },
    onclick: function () {
      if (editor.settings.ipreviewData.length > 0) {
        selectedChange(editor.settings.ipreviewData[0]);
      }
    }
  });
});