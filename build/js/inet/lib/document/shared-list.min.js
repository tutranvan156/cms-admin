var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        if (typeof b !== "function" && b !== null)
            throw new TypeError("Class extends value " + String(b) + " is not a constructor or null");
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
/**
 * #PACKAGE: document
 * #MODULE: shared-list
 */
/**
 * Copyright (c) 2018 iNet Solutions Corp.,
 * Created by Nguyen Ba Chi Cong<nbccong@inetcloud.vn>
 *         on 10:29 31/10/2018.
 * -------------------------------------------
 * @project cms-admin
 * @author nbchicong
 * @file SharedList.ts
 */
$(function () {
    var BasicSearch = /** @class */ (function (_super) {
        __extends(BasicSearch, _super);
        function BasicSearch() {
            var _this_1 = _super.call(this) || this;
            _this_1.id = 'edoc-basic-search';
            _this_1.url = iNet.getPUrl('admin/edoc/search');
            _this_1.formSearch = {};
            return _this_1;
        }
        BasicSearch.prototype.intComponent = function () {
            this.inputSearch = this.getEl().find('.grid-search-input');
            this.formSearch = {};
        };
        BasicSearch.prototype.getUrl = function () {
            return this.url;
        };
        BasicSearch.prototype.setFolder = function (folder) {
            this.folder = folder;
        };
        BasicSearch.prototype.getFolder = function () {
            if (this.folder) {
                return this.folder;
            }
            return this.assetFolder.getFirst();
        };
        BasicSearch.prototype.getData = function () {
            return {
                pageSize: CMSConfig.PAGE_SIZE,
                pageNumber: 0,
                keyword: this.inputSearch.val() || '',
                type: 'PROMULGATE',
                public: true,
                draft: false
            };
        };
        return BasicSearch;
    }(iNet.ui.grid.Search));
    var SharedList = /** @class */ (function (_super) {
        __extends(SharedList, _super);
        // @ts-ignore
        function SharedList() {
            var _this_1 = this;
            _this_1.id = 'edoc-shared-wg';
            _this_1.gridID = 'edoc-shared-list';
            // @ts-ignore
            _this_1.init();
            _this_1 = _super.call(this) || this;
            _this_1.id = 'edoc-shared-wg';
            _this_1.module = 'document';
            _this_1.resourceRoot = iNet.resources.cmsadmin;
            _this_1.gridID = 'edoc-shared-list';
            _this_1.remote = true;
            _this_1.url = {
                list: iNet.getPUrl('admin/edoc/search')
            };
            _this_1.selected = [];
            _this_1.toolbar = {
                UN_PUBLISHED: $('#list-btn-unpublished')
            };
            _this_1.dataSource = new iNet.ui.grid.DataSource({
                columns: [{
                        type: 'selection',
                        align: 'center',
                        width: 30
                    }, {
                        property: 'signNumber',
                        label: _this_1.getText('sign_number'),
                        type: 'label',
                        width: 200
                    }, {
                        property: 'content',
                        label: _this_1.getText('content'),
                        type: 'label'
                    }, {
                        property: 'promulgationDate',
                        label: _this_1.getText('promulgation_date'),
                        sortable: true,
                        type: 'text',
                        width: 150,
                        renderer: function (v) {
                            // @ts-ignore
                            return new Date(v).format(iNet.dateFormat);
                        }
                    }, {
                        type: 'action',
                        align: 'center',
                        buttons: [{
                                text: _this_1.getText('unpublished'),
                                icon: 'fa fa-times',
                                labelCls: 'label label-warning',
                                visibled: function (record) {
                                    return _this_1.getSecurity().hasRoles([CMSConfig.ROLE_ADMIN, CMSConfig.ROLE_LEGAL_DOC]);
                                },
                                fn: function (record) {
                                    _this_1.showUnPublishConfirm({
                                        uuid: record.uuid,
                                        authorUnitCode: record.authorUnitCode
                                    });
                                }
                            }]
                    }],
                delay: 250
            });
            _this_1.basicSearch = BasicSearch;
            _this_1.toolbar.UN_PUBLISHED.on('click', function () {
                _this_1.showUnPublishConfirm({
                    ids: _this_1.selected.map(function (item) { return item.uuid; }).join(CMSConfig.ARRAY_SEPARATOR)
                });
            });
            _this_1.getGrid().on('selectionchange', function (sm) {
                _this_1.selected = sm.getSelection();
                FormUtils.disableButton(_this_1.toolbar.UN_PUBLISHED, !(_this_1.selected.length > 0));
            });
            _this_1.getGrid().on('click', function (record) {
                _this_1.fireEvent('open', record, _this_1);
            });
            return _this_1;
        }
        SharedList.prototype.init = function () { };
        SharedList.prototype.unPublish = function (params) {
            var _this_1 = this;
            LegalDocumentAPI.shareEdoc(params, function (result) {
                if (result.type === CMSConfig.TYPE_ERROR)
                    _this_1.error(_this_1.getText('unpublished'), _this_1.getText('unpublished_error'));
                else {
                    _this_1.reload();
                    _this_1.success(_this_1.getText('unpublished'), _this_1.getText('unpublished_success'));
                }
            });
        };
        SharedList.prototype.showUnPublishConfirm = function (unPublishData) {
            var _this = this;
            var dialog = this.confirmDlg(_this.getText('unpublished'), _this.getText('unpublished_confirm'), function () {
                var params = dialog.getData();
                params['shr_stt'] = false;
                _this.unPublish(params);
                dialog.hide();
            });
            dialog.setTitle('<i class="fa fa-times-circle-o text-warning"></i> ' + _this.getText('unpublished'));
            dialog.setData(unPublishData);
            dialog.show();
        };
        return SharedList;
    }(iNet.ui.ListAbstract));
    // export class
    iNet.ns('iNet.ui.document.SharedList');
    iNet.ui.document.SharedList = SharedList;
});
